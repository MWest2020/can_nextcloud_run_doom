var E,f;const w=((E=window._oc_appswebroots)==null?void 0:E.doomnextcloud)||typeof OC<"u"&&((f=OC.appswebroots)==null?void 0:f.doomnextcloud)||"/custom_apps/doomnextcloud",i=`${w}/public/wasm/doom.js`,a=`${w}/public/assets/freedoom/freedoom1.wad`,u="/freedoom1.wad";function x(e){let n=!1;const r=()=>{var c,o;if(!n){n=!0;try{const t=(o=(c=window.Module)==null?void 0:c.SDL)==null?void 0:o.audioContext;t&&t.state==="suspended"&&t.resume().catch(()=>{})}catch(t){console.warn("[DoomNextcloud] Audio unlock failed (non-fatal):",t)}}};e.addEventListener("click",r,{once:!1}),e.addEventListener("keydown",r,{once:!1})}async function m(){const e=await fetch(a);if(!e.ok)throw new Error(`Failed to load the game. Check that Freedoom assets are installed correctly. (HTTP ${e.status} for ${a})`);const n=await e.arrayBuffer();return new Uint8Array(n)}function F(){return new Promise((e,n)=>{const r=document.createElement("script");r.src=i,r.onload=e,r.onerror=()=>n(new Error(`Failed to load WASM glue script: ${i}`)),document.head.appendChild(r)})}async function _(e,n){const r=await m();await new Promise((c,o)=>{window.Module={canvas:e,noInitialRun:!0,preRun:[function(){window.Module.FS.createDataFile("/",u.slice(1),r,!0,!0,!0)}],onRuntimeInitialized(){try{n&&(n.hidden=!0),x(e),window.Module.callMain(["-iwad",u]),c()}catch(t){o(t)}},print:t=>console.log("[doom]",t),printErr:t=>console.warn("[doom]",t),setStatus:t=>{t&&console.debug("[doom status]",t)}},F().catch(o)})}const A=174,p=172,h=173,K=175,y=27,Y=13,D=127,R=157,C=184,L=182,k=187,M=188,S=189,v=190,b=191,B=192,P=193,W=194,I=195,T=196,g=215,O=216,G={ArrowUp:h,ArrowDown:K,ArrowLeft:p,ArrowRight:A,Escape:y,Enter:Y,Backspace:D,Control:R,Alt:C,Shift:L," ":32,F1:k,F2:M,F3:S,F4:v,F5:b,F6:B,F7:P,F8:W,F9:I,F10:T,F11:g,F12:O,w:119,W:119,a:97,A:97,s:115,S:115,d:100,D:100,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,0:48},l=new Set(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"," ","Enter","Escape","Control","Alt","Shift","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12"]);function N(e,n){e.tabIndex<0&&(e.tabIndex=0);const r=(o,t)=>{const s=G[t];if(s===void 0)return;const d=n();d!=null&&d._DG_KeyEvent&&d._DG_KeyEvent(o?1:0,s)};e.addEventListener("keydown",o=>{l.has(o.key)&&o.preventDefault(),r(!0,o.key)}),e.addEventListener("keyup",o=>{l.has(o.key)&&o.preventDefault(),r(!1,o.key)}),e.addEventListener("click",()=>e.focus()),e.addEventListener("mousemove",o=>{const t=n();if(!(t!=null&&t._DG_MouseMoveEvent))return;const s=o.movementX??0,d=o.movementY??0;(s!==0||d!==0)&&t._DG_MouseMoveEvent(s,d)});const c=o=>{const t=n();if(!(t!=null&&t._DG_MouseButtonEvent))return;let s=0;o.buttons&1&&(s|=1),o.buttons&2&&(s|=2),o.buttons&4&&(s|=4),t._DG_MouseButtonEvent(s)};e.addEventListener("mousedown",c),e.addEventListener("mouseup",c)}document.addEventListener("DOMContentLoaded",async()=>{const e=document.getElementById("doomnextcloud-canvas"),n=document.getElementById("doomnextcloud-loading"),r=document.getElementById("doomnextcloud-error");if(!e){console.error("[DoomNextcloud] Canvas element not found in DOM.");return}try{N(e,()=>window.Module),await _(e,n)}catch(c){console.error("[DoomNextcloud] Failed to initialize runtime:",c),n&&(n.hidden=!0),r&&(r.hidden=!1)}});
