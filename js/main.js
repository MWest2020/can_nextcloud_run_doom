var E;const f=typeof OC<"u"&&((E=OC.appswebroots)!=null&&E.doomnextcloud)?OC.appswebroots.doomnextcloud:"/apps/doomnextcloud",i=`${f}/public/wasm/doom.js`,a=`${f}/public/assets/freedoom/freedoom1.wad`,u="/freedoom1.wad";function w(t){let n=!1;const r=()=>{var c,o;if(!n){n=!0;try{const e=(o=(c=window.Module)==null?void 0:c.SDL)==null?void 0:o.audioContext;e&&e.state==="suspended"&&e.resume().catch(()=>{})}catch(e){console.warn("[DoomNextcloud] Audio unlock failed (non-fatal):",e)}}};t.addEventListener("click",r,{once:!1}),t.addEventListener("keydown",r,{once:!1})}async function x(){const t=await fetch(a);if(!t.ok)throw new Error(`Failed to load the game. Check that Freedoom assets are installed correctly. (HTTP ${t.status} for ${a})`);const n=await t.arrayBuffer();return new Uint8Array(n)}function F(){return new Promise((t,n)=>{const r=document.createElement("script");r.src=i,r.onload=t,r.onerror=()=>n(new Error(`Failed to load WASM glue script: ${i}`)),document.head.appendChild(r)})}async function m(t,n){const r=await x();await new Promise((c,o)=>{window.Module={canvas:t,noInitialRun:!0,preRun:[function(){window.Module.FS.createDataFile("/",u.slice(1),r,!0,!0,!0)}],onRuntimeInitialized(){try{n&&(n.hidden=!0),w(t),window.Module.callMain(["-iwad",u]),c()}catch(e){o(e)}},print:e=>console.log("[doom]",e),printErr:e=>console.warn("[doom]",e),setStatus:e=>{e&&console.debug("[doom status]",e)}},F().catch(o)})}const _=174,A=172,p=173,h=175,K=27,y=13,Y=127,C=157,D=184,R=182,L=187,k=188,M=189,S=190,v=191,b=192,B=193,P=194,W=195,I=196,O=215,T=216,g={ArrowUp:p,ArrowDown:h,ArrowLeft:A,ArrowRight:_,Escape:K,Enter:y,Backspace:Y,Control:C,Alt:D,Shift:R," ":32,F1:L,F2:k,F3:M,F4:S,F5:v,F6:b,F7:B,F8:P,F9:W,F10:I,F11:O,F12:T,w:119,W:119,a:97,A:97,s:115,S:115,d:100,D:100,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,0:48},l=new Set(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"," ","Enter","Escape","Control","Alt","Shift","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12"]);function G(t,n){t.tabIndex<0&&(t.tabIndex=0);const r=(o,e)=>{const s=g[e];if(s===void 0)return;const d=n();d!=null&&d._DG_KeyEvent&&d._DG_KeyEvent(o?1:0,s)};t.addEventListener("keydown",o=>{l.has(o.key)&&o.preventDefault(),r(!0,o.key)}),t.addEventListener("keyup",o=>{l.has(o.key)&&o.preventDefault(),r(!1,o.key)}),t.addEventListener("click",()=>t.focus()),t.addEventListener("mousemove",o=>{const e=n();if(!(e!=null&&e._DG_MouseMoveEvent))return;const s=o.movementX??0,d=o.movementY??0;(s!==0||d!==0)&&e._DG_MouseMoveEvent(s,d)});const c=o=>{const e=n();if(!(e!=null&&e._DG_MouseButtonEvent))return;let s=0;o.buttons&1&&(s|=1),o.buttons&2&&(s|=2),o.buttons&4&&(s|=4),e._DG_MouseButtonEvent(s)};t.addEventListener("mousedown",c),t.addEventListener("mouseup",c)}document.addEventListener("DOMContentLoaded",async()=>{const t=document.getElementById("doomnextcloud-canvas"),n=document.getElementById("doomnextcloud-loading"),r=document.getElementById("doomnextcloud-error");if(!t){console.error("[DoomNextcloud] Canvas element not found in DOM.");return}try{G(t,()=>window.Module),await m(t,n)}catch(c){console.error("[DoomNextcloud] Failed to initialize runtime:",c),n&&(n.hidden=!0),r&&(r.hidden=!1)}});
